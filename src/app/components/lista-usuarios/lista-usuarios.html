<div class="container my-4">

  <!-- Header -->
  <div class="mb-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h2 class="fw-bold">Gestión de Usuarios</h2>

      <button class="btn btn-primary" routerLink="/usuarios/nuevo">
        Nuevo Usuario
      </button>
    </div>

    <div class="header-info shadow-sm">
      <p class="mb-0">Total de usuarios: {{ usuariosFiltrados.length }}</p>
    </div>
  </div>

  <!-- Filtros -->
  <div class="card filtros mb-4">
    <div class="card-body d-flex gap-4">

      <div class="filtro-group">
        <label class="form-label fw-semibold" for="filtroEstado">Estado:</label>
        <select
          class="form-select"
          id="filtroEstado"
          [(ngModel)]="filtroEstado"
          (change)="onFiltroChange()"
        >
          <option *ngFor="let estado of estados" [value]="estado">{{ estado }}</option>
        </select>
      </div>

      <div class="filtro-group">
        <label class="form-label fw-semibold" for="filtroRol">Rol:</label>
        <select
          class="form-select"
          id="filtroRol"
          [(ngModel)]="filtroRol"
          (change)="onFiltroChange()"
        >
          <option *ngFor="let rol of roles" [value]="rol">{{ rol }}</option>
        </select>
      </div>

    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading text-center py-4">
    <div class="spinner-border" role="status"></div>
    <p class="mt-2">Cargando usuarios...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error" class="alert alert-danger text-center">
    {{ error }}
  </div>

  <!-- Tabla -->
  <div *ngIf="!loading" class="table-container card shadow-sm">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>Nombre</th>
            <th>Usuario</th>
            <th>Rol</th>
            <th>Estado</th>
            <th>Fecha Creación</th>
            <th class="text-center">Acciones</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let usuario of usuariosFiltrados; let i = index">
            <td>{{ i + 1 }}</td>
            <td>{{ usuario.nombre }}</td>
            <td>{{ usuario.nombreUsuario }}</td>

            <td>
              <span [class]="getRolBadgeClass(usuario.rol)">{{ usuario.rol }}</span>
            </td>

            <td>
              <span [class]="getEstadoBadgeClass(usuario.estado)">{{ usuario.estado }}</span>
            </td>

            <td>{{ usuario.fechaCreacion | date:'dd/MM/yyyy HH:mm' }}</td>

            <td class="text-center">
              <div class="d-flex justify-content-center gap-2 actions">
                <button class="btn btn-edit btn-sm" [routerLink]="['/usuarios/editar', usuario.id]">
                  Editar
                </button>

                <button class="btn btn-status btn-sm" (click)="cambiarEstadoUsuario(usuario)">
                  {{ usuario.estado === 'ACTIVO' ? 'Desactivar' : 'Activar' }}
                </button>

                <button class="btn btn-delete btn-sm" (click)="eliminarUsuario(usuario.id)">
                  Eliminar
                </button>
              </div>
            </td>

          </tr>

          <tr *ngIf="usuariosFiltrados.length === 0">
            <td colspan="7" class="text-center text-muted py-3 fst-italic">
              No se encontraron usuarios
            </td>
          </tr>

        </tbody>
      </table>
    </div>
  </div>

</div>
